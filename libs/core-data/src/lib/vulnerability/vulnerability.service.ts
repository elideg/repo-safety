import { Vulnerability } from '@rv/core-data';
import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http'
import { map } from 'rxjs/operators'
import { of } from 'rxjs'

const BASE_URL = 'https://mdv05-projects-db.herokuapp.com'

@Injectable({
  providedIn: 'root'
})
export class VulnerabilityService {
  model = 'data'

  constructor(private httpClient: HttpClient) { }

  getUrl() {
    return `${BASE_URL}/${this.model}`;
  }

  all() {
    return this.httpClient.get(this.getUrl()).pipe(
      map((res: any) => res.organization.repositories.nodes),
      map(
      (res: any) => ({
        allrepos: res,
        notfixed: res.filter((r) => r.vulnerabilityAlerts.totalCount > 0),
      }))
    )
  }

}

